<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Python-web:Django - Mustard's docs</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome.min.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-1.10.2.min.js" defer></script>
    <script src="../../js/bootstrap-3.3.7.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../..">Mustard's docs</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">help <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../help/start/">快速开始</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">python notes <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../Chapter1/">编程简介</a>
</li>
                                    
<li >
    <a href="../Chapter2/">算术、字符串与变量</a>
</li>
                                    
<li >
    <a href="../Chapter3/">编写程序</a>
</li>
                                    
<li >
    <a href="../Chapter4.md">流程控制</a>
</li>
                                    
<li >
    <a href="../Chapter5/">函数</a>
</li>
                                    
<li >
    <a href="../Chapter6/">字符串</a>
</li>
                                    
<li >
    <a href="../Chapter7/">数据结构</a>
</li>
                                    
<li >
    <a href="../Chapter8.md">输入和输出</a>
</li>
                                    
<li >
    <a href="../Chapter9/">异常处理</a>
</li>
                                    
<li >
    <a href="../Chapter10/">面向对象编程</a>
</li>
                                    
<li >
    <a href="../Flask/">Python-web:Flask</a>
</li>
                                    
<li class="active">
    <a href="./">Python-web:Django</a>
</li>
                                    
<li >
    <a href="../Q&A/">Q&A</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../Flask/">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../Q&A/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/wxmustard/note2/edit/master/docs/python/Django.md">Edit on Mustard's github</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#-django">企业级开发框架-Django</a></li>
            <li><a href="#_1">开发环境</a></li>
            <li><a href="#django">Django</a></li>
            <li><a href="#django-rest-framework">使用Django Rest framework框架</a></li>
            <li><a href="#qa">Q&amp;A</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="-django">企业级开发框架-Django</h1>
<h2 id="_1">开发环境</h2>
<blockquote>
<p>在开发Python应用程序的时候，系统安装的Python3只有一个版本：3.4。所有第三方的包都会被<code>pip</code>安装到Python3的<code>site-packages</code>目录下。</p>
<p>如果我们要同时开发多个应用程序，那这些应用程序都会共用一个Python，就是安装在系统的Python 3。如果应用A需要jinja 2.7，而应用B需要jinja 2.6怎么办？</p>
<p>这种情况下，每个应用可能需要各自拥有一套“独立”的Python运行环境。virtualenv就是用来为一个应用创建一套“隔离”的Python运行环境.</p>
</blockquote>
<ul>
<li>安装<code>virtualenv</code></li>
</ul>
<p><code>bash
  sudo pip install virtualenv virtualenvwrapper</code></p>
<ul>
<li>更改<code>.zshrc</code></li>
</ul>
<p><code>bash
  export WORKON_HOME=/home/mustard/.virtualenvs
  export PROJECT_HOME=/home/mustard/workspace
  export VIRTUALENVWRAPPER_PYTHON=/usr/bin/python
  source /usr/local/bin/virtualenvwrapper.sh
  # 使更改生效
  source .zshrc</code></p>
<ul>
<li>创建一个新的项目</li>
</ul>
<p>```bash
  # 创建项目目录
  mkdir myproject
  cd myproject/
  # 创建一个独立的Python运行环境，命名为venv
  virtualenv --no-site-packages venv
  # virtualenv命令是创建一个独立的Python运行环境
  # --no-site-packages参数是创建一个干净的不包含第三方包的Python运行环境</p>
<p>#进入venv环境
  source venv/bin/activate
  # 此时可以使用pip install等命令了
  ```</p>
<h2 id="django">Django</h2>
<ul>
<li>安装<code>bpython</code>，添加自动补全功能</li>
</ul>
<p>```python
  # 进入venv环境后
  # 1.升级pip
  pip install --upgrade pip
  # 2.安装Django
  pip install Django
  # 3.安装bpython
  pip install bpython
  # 进入bpython，查询django版本</p>
<blockquote>
<blockquote>
<blockquote>
<p>import django
django.VERSION
  (1, 11, 7, 'final', 0)
  ```</p>
</blockquote>
</blockquote>
</blockquote>
<h3 id="django_1"><code>Django</code>基本命令</h3>
<ul>
<li>
<p>```bash
  # 创建新项目 mysite
  django-admin startproject mysite
  # 创建新应用（app），learn
  python manage.py startapp learn
  # 将新定义的app加到settings.py中的INSTALL_APPS中
  # 修改mysite/mysite/settings.py
  INSTALLED_APPS = (
      'django.contrib.admin',
      'django.contrib.auth',
      'django.contrib.contenttypes',
      'django.contrib.sessions',
      'django.contrib.messages',
      'django.contrib.staticfiles',</p>
<p>'learn',
  )
  # 新建的 app 如果不加到 INSTALL_APPS 中的话, django 就不能自动找到app中的模板文件(app-name/templates/下的文件)和静态文件(app-name/static/中的文件)
  ```</p>
</li>
<li>
<p><code>requirements.txt</code></p>
</li>
</ul>
<blockquote>
<p>python项目中必须包含一个 requirements.txt 文件，用于记录所有依赖包及其精确的版本号。以便新环境部署。</p>
</blockquote>
<p><code>bash
  # 生成requirements.txt
  pip3 freeze &gt;requirements.txt
  # 部署环境
  pip3 install -r requirements.txt</code></p>
<h2 id="django-rest-framework">使用Django Rest framework框架</h2>
<h3 id="_2">基础设置</h3>
<ul>
<li>下载框架</li>
</ul>
<pre><code class="bash">pip3 install djangorestframework
pip3 install pygments
</code></pre>

<ul>
<li>
<p>基础配置</p>
</li>
<li>
<p>将app添加至项目中</p>
</li>
</ul>
<p><code>python
  # 将'vm.apps.VmConfig'添加到kvm/settings.py中
  INSTALLED_APPS = [
      'vm.apps.VmConfig',
  ]</code></p>
<ul>
<li>修改项目的url</li>
</ul>
<p><code>python
  # 打开kvm/urls.py,将以下语句添加进去
  # 提示：vm/urls.py需要自行创建
  from django.conf.urls import url , include
  urlpatterns = [
      path('admin/', admin.site.urls),
      url(r'^',include('vm.urls'))
  ]</code></p>
<ul>
<li>创建<code>vm/urls.py</code></li>
</ul>
<p><code>python
  # url是预先设计好的
  from django.conf.urls import url
  from vm import views
  from rest_framework.urlpatterns import format_suffix_patterns
  urlpatterns = [
      url(r'^v1/vps/$',views.kvm_list),
      url(r'^v1/vps/kvmname/(?P&lt;name&gt;[a-zA-Z0-9]+)/$',views.kvm),
  ]
  urlpatterns = format_suffix_patterns(urlpatterns)</code></p>
<h3 id="_3">数据库操作</h3>
<ul>
<li>配置数据库文件</li>
</ul>
<pre><code class="python"># 修改django项目的setting.py文件
DATABASES = {
        'default': {
       # 'ENGINE': 'django.db.backends.sqlite3',
       # 'NAME': os.path.join(BASE_DIR, 'db.sqlite3'),
        'ENGINE': 'django.db.backends.mysql',
        'NAME': 's3test',
        'USER':'root',
        'PASSWORD':'root',
        'HOST':'127.0.0.1',
        'PORT':'3306',
    }
}
</code></pre>

<ul>
<li>编写模型类</li>
</ul>
<pre><code class="python"># 编写项目app的models.py 文件,如
from django.db import models

# Create your models here.
class buckets(models.Model):
    id = models.AutoField(primary_key = True)
    bucket_name = models.CharField(max_length = 32)
    create_id = models.CharField(max_length =8)
    create_at = models.DateTimeField(auto_now_add= True)
    objects = models.Manager() 
class users(models.Model):
    # 参数中包含max_length为可变长度（varchar类型），没有参数的为定长（char类型）
    id = models.AutoField(primary_key = True)
    access_key = models.CharField(max_length = 64)
    access_secret = models.CharField(max_length = 64)
    create_id = models.CharField(max_length =8)
    # 如果在数据中已有数据的基础上需要更改数据库设计，需要先清空表中数据，并为新增字段添加默认值
    server_address = models.CharField(max_length = 64,default='')
    # auto_now 自动创建---无论添加或修改，都是当前操作的时间 ,auto_now_add 自动创建---永远是创建时的时间
    create_at = models.DateTimeField(auto_now_add= True)
    # null=True数据库中的字段允许为空，但是django会自动检测数据不允许为空值，需要添加blank=True才可以
    update_at = models.DateTimeField(auto_now=True,null=True,blank=True)
    objects = models.Manager() 
</code></pre>

<ul>
<li>将新建的<code>models</code>同步至数据库</li>
</ul>
<pre><code class="cmd"># 查询当前数据库与本地的models之间的差异,生成合并代码
python manage.py makemigrations
# 将何必代码导入数据库
python manage.py migrate
</code></pre>

<h3 id="viewspy">数据库的基本操作(<code>views.py</code>)</h3>
<ul>
<li>增</li>
</ul>
<pre><code class="python">from s3.models import buckets,users,shares
bucket = buckets(bucket_name ='mytest',create_id='17721803')
bucket.save()
</code></pre>

<ul>
<li>查</li>
</ul>
<pre><code class="python">from s3.models import buckets,users,shares
# 获取表中所有数据
bucket = buckets.objects.all()
# 获得表中所有数据的values
bucket = buckets.objects.all().values('id','bucket_name')
bucket1 = buckets.objects.filter().values('id','bucket_name')
# 使用values进行查询数据时将返回一个QuerySet对象，如&lt;QuerySet [{'bucket_name': 'wxmust', 'id': 3}, {'bucket_name': 'mytest', 'id': 9}]&gt;
# 形式为[{}]，列表中包含字典的形式
bucket1[0]['id']
# 获得单条数据
bucket = buckets.objects.get(id = 1)
bucket = buckets.objects.filter(id = 1)
</code></pre>

<ul>
<li>删</li>
</ul>
<pre><code class="python">from s3.models import buckets,users,shares
# 删除单条数据
buckets.objects.get(id=1).delete()
# 删除多条符合条件的数据
buckets.objects.filter(id=1).delete()
# 删除所有数据
buckets.objects.all().delete()
</code></pre>

<ul>
<li>改</li>
</ul>
<pre><code class="python">from s3.models import buckets,users,shares
# 1: 获得单条数据信息
# 2: 修改数据信息
# 3: save()
user = users.objects.get(create_id='17721803')
user.access_key = 'wxmust'
user.access_secret = 'wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY'
user.save()
</code></pre>

<h3 id="response">响应头Response</h3>
<h4 id="_4">返回状态码</h4>
<ul>
<li>使用方法：</li>
</ul>
<pre><code class="python"> return Response(status=status.HTTP_204_NO_CONTENT)
</code></pre>

<ul>
<li>状态码列表：</li>
</ul>
<pre><code class="python">HTTP_100_CONTINUE = 100
HTTP_101_SWITCHING_PROTOCOLS = 101
HTTP_200_OK = 200
HTTP_201_CREATED = 201
HTTP_202_ACCEPTED = 202
HTTP_203_NON_AUTHORITATIVE_INFORMATION = 203
HTTP_204_NO_CONTENT = 204
HTTP_205_RESET_CONTENT = 205
HTTP_206_PARTIAL_CONTENT = 206
HTTP_207_MULTI_STATUS = 207
HTTP_300_MULTIPLE_CHOICES = 300
HTTP_301_MOVED_PERMANENTLY = 301
HTTP_302_FOUND = 302
HTTP_303_SEE_OTHER = 303
HTTP_304_NOT_MODIFIED = 304
HTTP_305_USE_PROXY = 305
HTTP_306_RESERVED = 306
HTTP_307_TEMPORARY_REDIRECT = 307
HTTP_400_BAD_REQUEST = 400
HTTP_401_UNAUTHORIZED = 401
HTTP_402_PAYMENT_REQUIRED = 402
HTTP_403_FORBIDDEN = 403
HTTP_404_NOT_FOUND = 404
HTTP_405_METHOD_NOT_ALLOWED = 405
HTTP_406_NOT_ACCEPTABLE = 406
HTTP_407_PROXY_AUTHENTICATION_REQUIRED = 407
HTTP_408_REQUEST_TIMEOUT = 408
HTTP_409_CONFLICT = 409
HTTP_410_GONE = 410
HTTP_411_LENGTH_REQUIRED = 411
HTTP_412_PRECONDITION_FAILED = 412
HTTP_413_REQUEST_ENTITY_TOO_LARGE = 413
HTTP_414_REQUEST_URI_TOO_LONG = 414
HTTP_415_UNSUPPORTED_MEDIA_TYPE = 415
HTTP_416_REQUESTED_RANGE_NOT_SATISFIABLE = 416
HTTP_417_EXPECTATION_FAILED = 417
HTTP_422_UNPROCESSABLE_ENTITY = 422
HTTP_423_LOCKED = 423
HTTP_424_FAILED_DEPENDENCY = 424
HTTP_428_PRECONDITION_REQUIRED = 428
HTTP_429_TOO_MANY_REQUESTS = 429
HTTP_431_REQUEST_HEADER_FIELDS_TOO_LARGE = 431
HTTP_451_UNAVAILABLE_FOR_LEGAL_REASONS = 451
HTTP_500_INTERNAL_SERVER_ERROR = 500
HTTP_501_NOT_IMPLEMENTED = 501
HTTP_502_BAD_GATEWAY = 502
HTTP_503_SERVICE_UNAVAILABLE = 503
HTTP_504_GATEWAY_TIMEOUT = 504
HTTP_505_HTTP_VERSION_NOT_SUPPORTED = 505
HTTP_507_INSUFFICIENT_STORAGE = 507
HTTP_511_NETWORK_AUTHENTICATION_REQUIRED = 511
</code></pre>

<h4 id="response_1">自定义Response响应头</h4>
<blockquote>
<p>参考资料： http://www.django-rest-framework.org/api-guide/responses/#creating-responses</p>
</blockquote>
<pre><code class="python"># views.py 文件中进行自定义Response
    response = Response()
    # response = Response(status = status.HTTP_200_OK)
    response['server'] = 'SHU'
    response1['content_type'] = 'application/octet-stream'
return response
</code></pre>

<h2 id="qa">Q&amp;A</h2>
<h3 id="_5">字典排序</h3>
<ul>
<li>按照字典中的<code>Key</code>排序</li>
</ul>
<pre><code class="python">sorted(dict.keys()) # key升序排列
sorted(dict.keys(),reverse=True) # key降序排列
</code></pre></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"search": 83, "next": 78, "help": 191, "previous": 80};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
